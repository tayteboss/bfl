{{ 'gear-rental.css' | asset_url | stylesheet_tag }}
{{ 'contact.css' | asset_url | stylesheet_tag }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker.min.css">
<style>
  /* Scoped datepicker theme overrides */
  .gear-single .datepicker-cell.selected,
  .gear-single .datepicker-cell.range-start,
  .gear-single .datepicker-cell.range-end {
    background-color: var(--color-yellow);
    color: var(--color-black);
  }

  .gear-single .datepicker-cell.focused:not(.selected):not(.range-start):not(.range-end) {
    border-color: var(--color-yellow);
  }

  .gear-single .datepicker-view .week .datepicker-cell:hover {
    background-color: var(--color-yellow);
    color: var(--color-black);
  }
</style>

<div class="gear-single">
  <section class="gear-single-product">
    <div class="layout-wrapper layout-grid">
      <div class="gear-single__image-wrapper">
        {% if metaobject.image %}
          <div class="gear-single__image-inner">
            <img
              src="{{ metaobject.image | image_url }}"
              width="auto"
              height="auto"
              alt="{{ metaobject.brand_name }} {{ metaobject.title }}"
            >
          </div>
        {% endif %}
      </div>
      <div class="gear-single__content">
        <div class="gear-card__title-wrapper">
          {% if metaobject.brand_name %}
            <h4 class="type-h1-small">{{ metaobject.brand_name }}</h4>
          {% endif %}
          {% if metaobject.title %}
            <h5 class="type-h1-small">{{ metaobject.title }}</h5>
          {% endif %}
        </div>
        <div class="gear-card__price-wrapper">
          {% if metaobject.price_per_day %}
            <div class="gear-card__price-card">
              <p class="type-p-large">{{ metaobject.price_per_day }}</p>
              <p class="type-p">/day or weekend</p>
            </div>
          {% endif %}
          {% if metaobject.price_per_week %}
            <div class="gear-card__price-card">
              <p class="type-p-large">{{ metaobject.price_per_week }}</p>
              <p class="type-p">/week</p>
            </div>
          {% endif %}
        </div>

        {% if metaobject.description %}
          <div class="gear-card__description">
            <div class="type-p rich-text">{{ metaobject.description }}</div>
          </div>
        {% endif %}

        <div class="gear-card-accordions-list" data-gear-accordion-list>
          {% if metaobject.accordion_1_title %}
            {% assign accordion_uid = metaobject.id | append: '-accordion-1' %}
            <button
              class="gear-card-accordion"
              type="button"
              aria-expanded="false"
              aria-controls="gear-accordion-content-{{ accordion_uid }}"
              data-gear-accordion-trigger
            >
              <div class="gear-card-accordion__header">
                <div
                  class="gear-card-accordion__indicator gear-card-accordion__indicator--black-hover"
                  aria-hidden="true"
                ></div>
                <p class="type-p">{{ metaobject.accordion_1_title }}</p>
              </div>
              <div
                class="gear-card-accordion__content"
                id="gear-accordion-content-{{ accordion_uid }}"
                role="region"
                aria-labelledby="gear-accordion-{{ accordion_uid }}"
                hidden
                data-gear-accordion-content
              >
                <div class="gear-card-accordion__inner">
                  <p class="type-p" aria-hidden="true">â€”</p>
                  <div class="type-p">{{ metaobject.accordion_1_content | metafield_tag }}</div>
                </div>
              </div>
            </button>
          {% endif %}

          {% if metaobject.accordion_2_title %}
            {% assign accordion_uid_b = metaobject.id | append: '-accordion-2' %}
            <button
              class="gear-card-accordion"
              type="button"
              aria-expanded="false"
              aria-controls="gear-accordion-content-{{ accordion_uid_b }}"
              data-gear-accordion-trigger
            >
              <div class="gear-card-accordion__header">
                <div
                  class="gear-card-accordion__indicator gear-card-accordion__indicator--black-hover"
                  aria-hidden="true"
                ></div>
                <p class="type-p">{{ metaobject.accordion_2_title }}</p>
              </div>
              <div
                class="gear-card-accordion__content"
                id="gear-accordion-content-{{ accordion_uid_b }}"
                role="region"
                aria-labelledby="gear-accordion-{{ accordion_uid_b }}"
                hidden
                data-gear-accordion-content
              >
                <div class="gear-card-accordion__inner">
                  <p class="type-p" aria-hidden="true">â€”</p>
                  <div class="type-p">{{ metaobject.accordion_2_content | metafield_tag }}</div>
                </div>
              </div>
            </button>
          {% endif %}
        </div>
        <div class="gear-single__contact-form">
          {% form 'contact', class: 'contact-form' %}
            <input type="hidden" name="contact[tags]" value="gear-rental-inquiry" aria-label="Form tag">
            <input type="hidden" name="contact[topic]" value="Gear Rental" aria-label="Form topic">
            <input type="hidden" name="contact[page]" value="{{ request.path }}" aria-label="Page URL">
            <input
              type="hidden"
              name="contact[body]"
              value="Camera: {{ metaobject.brand_name }} â€” {{ metaobject.title }}"
              aria-label="Camera details"
            >

            {%- if form.posted_successfully? -%}
              <h3
                class="contact-form__message contact-form__message--success form__message type-h1-x-small"
                id="GearRentalContact-success--{{ section.id }}"
                tabindex="-1"
                autofocus
              >
                Thank you, we'll get back to you as soon as possible.
              </h3>
            {%- elsif form.errors -%}
              <small
                class="contact-form__message form__message type-p-large"
                id="GearRentalContact-error--{{ section.id }}"
              >
                {{ form.errors | json }}
              </small>
            {%- else -%}
              <h2 class="gear-single-contact-form__heading type-h1-x-small">Rental Application</h2>
              <div class="gear-single-contact-form__subtitle type-p-large badge-button">
                Currently only available in Miami
              </div>
              <div class="contact-form__fields">
                <div class="contact-form__fields-inner">
                  <legend class="type-p gear-single-contact-form__legend">Contact details</legend>
                  <div class="form-field">
                    <input
                      id="GearRentalContactFullName--{{ section.id }}"
                      type="text"
                      name="contact[name]"
                      class="field__input"
                      value="{{ form.name }}"
                      aria-required="true"
                      placeholder="Full name*"
                      aria-label="Full name"
                      required
                    >
                  </div>

                  <div class="form-field">
                    <input
                      id="GearRentalContactEmail--{{ section.id }}"
                      type="email"
                      name="contact[email]"
                      class="field__input"
                      value="{{ form.email }}"
                      aria-required="true"
                      autocorrect="off"
                      autocapitalize="off"
                      autocomplete="email"
                      placeholder="Email*"
                      aria-label="Email"
                      required
                    >
                  </div>

                  <div class="form-field">
                    <input
                      id="GearRentalContactPhone--{{ section.id }}"
                      type="tel"
                      name="contact[phone]"
                      class="field__input"
                      value="{{ form.phone }}"
                      aria-required="false"
                      placeholder="Phone"
                      aria-label="Phone"
                    >
                  </div>
                </div>

                <div class="contact-form__fields-inner">
                  <legend class="type-p gear-single-contact-form__legend">Hire dates (minimum 2 days)</legend>
                  <div class="form-field">
                    <div id="GearRentalHireDates--{{ section.id }}" class="input-daterange">
                      <input
                        id="GearRentalHireStart--{{ section.id }}"
                        type="text"
                        name="contact[hire_start]"
                        class="field__input"
                        placeholder="Pickup Date"
                        aria-label="Pickup Date"
                        autocomplete="off"
                      >
                      <input
                        id="GearRentalHireEnd--{{ section.id }}"
                        type="text"
                        name="contact[hire_end]"
                        class="field__input"
                        placeholder="Return"
                        aria-label="Return"
                        autocomplete="off"
                      >
                    </div>
                  </div>
                  <p
                    id="GearRentalHireDatesError--{{ section.id }}"
                    class="gear-single-contact-form__error type-p"
                    role="alert"
                    aria-live="polite"
                    hidden
                  >
                    Please select a rental period of at least 2 days.
                  </p>
                </div>

                <div class="contact-form__fields-inner">
                  <legend class="type-p gear-single-contact-form__legend">Already insured?</legend>
                  <div class="form-field">
                    <fieldset class="field__group" aria-label="Already insured?">
                      <div class="bubble-options" role="radiogroup" aria-label="Already insured?">
                        <label class="bubble-option">
                          <input
                            id="GearRentalInsuredYes--{{ section.id }}"
                            type="radio"
                            name="contact[insured]"
                            value="Yes"
                            required
                          >

                          <div class="bubble-option__inner">
                            <div class="bubble-option__icon"></div>
                            <div class="bubble-option__label">Yes</div>
                          </div>
                        </label>
                        <label class="bubble-option">
                          <input
                            id="GearRentalInsuredNo--{{ section.id }}"
                            type="radio"
                            name="contact[insured]"
                            value="No"
                            required
                          >
                          <div class="bubble-option__inner">
                            <div class="bubble-option__icon"></div>
                            <div class="bubble-option__label">No</div>
                          </div>
                        </label>
                      </div>
                    </fieldset>
                  </div>
                </div>

                <div class="form-field form-field--submit form-field--submit-gear-rental">
                  <button
                    type="submit"
                    class="contact-form__button field__button primary-button primary-button--black"
                    name="commit"
                    id="GearRentalContactSubmit--{{ section.id }}"
                    aria-label="Submit gear rental inquiry"
                  >
                    <span class="svg-wrapper">Submit ðŸ’Œ</span>
                  </button>
                </div>
              </div>
            {%- endif -%}
          {% endform %}
        </div>
      </div>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker-full.min.js" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var rangeContainer = document.getElementById('GearRentalHireDates--{{ section.id }}');
    if (rangeContainer && window.DateRangePicker) {
      new DateRangePicker(rangeContainer, {
        autohide: true,
        minDate: new Date(),
        format: 'mm-dd-yyyy',
      });
      rangeContainer.addEventListener('changeDate', validateHireDates);
    }

    var hireStartInput = document.getElementById('GearRentalHireStart--{{ section.id }}');
    var hireEndInput = document.getElementById('GearRentalHireEnd--{{ section.id }}');
    var errorEl = document.getElementById('GearRentalHireDatesError--{{ section.id }}');
    var form = document.querySelector('.gear-single__contact-form form');

    function parseDate(value) {
      if (!value) return null;
      var parts = value.split('-');
      if (parts.length !== 3) return null;

      var month = parseInt(parts[0], 10) - 1;
      var day = parseInt(parts[1], 10);
      var year = parseInt(parts[2], 10);

      if (isNaN(month) || isNaN(day) || isNaN(year)) return null;

      return new Date(year, month, day);
    }

    function validateHireDates() {
      if (!hireStartInput || !hireEndInput || !errorEl) {
        return true;
      }

      var startDate = parseDate(hireStartInput.value);
      var endDate = parseDate(hireEndInput.value);

      if (!startDate || !endDate) {
        errorEl.hidden = false;
        errorEl.textContent = 'Please select both pickup and return dates (minimum 2 days).';
        return false;
      }

      var diffTime = endDate.getTime() - startDate.getTime();
      var diffDays = diffTime / (1000 * 60 * 60 * 24);

      // Allow exactly 2 days (i.e. two selected dates) â€“ only block if the range is shorter than that
      if (diffDays < 1) {
        errorEl.hidden = false;
        errorEl.textContent = 'Please select a rental period of at least 2 days.';
        return false;
      }

      errorEl.hidden = true;
      return true;
    }

    if (form) {
      form.addEventListener('submit', function (event) {
        if (!validateHireDates()) {
          event.preventDefault();
          if (hireStartInput) {
            hireStartInput.focus();
          }
        }
      });
    }

    if (hireStartInput) {
      hireStartInput.addEventListener('change', validateHireDates);
    }

    if (hireEndInput) {
      hireEndInput.addEventListener('change', validateHireDates);
    }

    // No need to assemble full name; a single Full Name input is used
  });
</script>

{% schema %}
{
  "name": "gear-rental-single",
  "settings": []
}
{% endschema %}
