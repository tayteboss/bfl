<script>
  document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("film-service-form");
    const rollsInput = document.getElementById("rolls-input");
    const subtotalEl = document.getElementById("subtotal");
    const discountsEl = document.getElementById("discounts");
    const totalEl = document.getElementById("total");

    function updateSummary() {
      let basePrice = {{ section.settings.base_price | default: 14 }};
      let rolls = parseInt(rollsInput.value) || 1;
      let subtotal = basePrice * rolls;
      let discount = 0;

      form.querySelectorAll("input[type='checkbox'][name^='properties']:checked").forEach(input => {
        let price = parseFloat(input.dataset.price) || 0;
        let isDiscount = input.dataset.discount === "true";

        if (isDiscount) {
          let percent = parseFloat(input.dataset.discountPercent) || 0;
          discount += subtotal * (percent / 100);
        } else {
          subtotal += price * rolls;
        }
      });

      let total = subtotal - discount;
      subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
      discountsEl.textContent = `-$${discount.toFixed(2)}`;
      totalEl.textContent = `$${total.toFixed(2)}`;
    }

    function updateSelections() {
      let getValue = (selector) => {
        let el = form.querySelector(selector);
        return el ? el.value : "–";
      };

      document.getElementById("summary-store").textContent = getValue("input[name='properties[Store]']:checked");
      document.getElementById("summary-service").textContent = getValue("input[name='properties[Service]']:checked");
      document.getElementById("summary-film").textContent = getValue("input[name='properties[Film Format]']:checked");
      document.getElementById("summary-process").textContent = getValue("input[name='properties[Process]']:checked");
      document.getElementById("summary-rolls").textContent = rollsInput.value || "–";
      document.getElementById("summary-scanner").textContent = getValue("input[name='properties[Scanner]']:checked");
      document.getElementById("summary-resolution").textContent = getValue("input[name='properties[Resolution]']:checked");
      document.getElementById("summary-prints").textContent = getValue("input[name='properties[Printing]']:checked");
      document.getElementById("summary-delivery").textContent = getValue("input[name='properties[Delivery]']:checked");

      // Dynamic Add-ons
      form.querySelectorAll("input[type='checkbox'][name^='properties']").forEach(input => {
        let safeId = input.name.replace("properties[", "").replace("]", "").replace(/\s+/g, "-").toLowerCase();
        let span = document.getElementById("summary-addon-" + (input.getAttribute("id") || safeId));
        if (span) {
          span.textContent = input.checked ? "Yes" : "No";
        }
      });
    }

    form.addEventListener("change", function() {
      updateSelections();
      updateSummary();
    });
    rollsInput.addEventListener("input", function() {
      updateSelections();
      updateSummary();
    });

    updateSelections();
    updateSummary();
  });
</script>
